<!DOCTYPE html>
<html>
  <head>
    <title>@tezzutezzu/world-history-timeline</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
  <body>
    <div class="container">
      
        <p>
          Version: <select id="version-selector">
          
            <option>
              v7.3.0
            </option>
          
            <option>
              v6.7.0
            </option>
          
            <option selected>
              v5.13.0
            </option>
          
            <option>
              v4.13.0
            </option>
          
            <option>
              v3.5.17
            </option>
          
        </select>
        <a href="../diff">Compare versions</a>
    </p>
      

      <h1>
        
          World History Timeline
        
      </h1>
      <p>Adapted from <a href="https://observablehq.com/@tezzutezzu/world-history-timeline">https://observablehq.com/@tezzutezzu/world-history-timeline</a></p>
      <iframe sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="raw/index.html" marginwidth="0" marginheight="0" scrolling="yes">
      </iframe>
      
        <div class="readme">
          <p>This is where I'll write some words</p>
<p>It's just a test, these words here!</p>
<blockquote>
<p>What about this?</p>
</blockquote>
<p><code>python
What about this?</code></p>
        </div>
      
      
          <div class="file">
          <h2>index.html</h2>
          
              <pre><code class="language-html">&lt;div id=&#34;chart&#34;&gt;&lt;/div&gt;
&lt;script src=&#34;https://cdnjs.cloudflare.com/ajax/libs/d3/5.13.0/d3.min.js&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;style.css&#34;&gt;
&lt;script src=&#34;script.js&#34;&gt;&lt;/script&gt;</code></pre>
          
          </div>
      
          <div class="file">
          <h2>Screen Shot 2022-01-24 at 3.33.22 PM.png</h2>
          
              <img src="raw/Screen Shot 2022-01-24 at 3.33.22 PM.png" />
          
          </div>
      
          <div class="file">
          <h2>style.css</h2>
          
              <pre><code class="language-css">svg {
  font: 11px sans-serif;
}
</code></pre>
          
          </div>
      
          <div class="file">
          <h2>script.js</h2>
          
              <pre><code class="language-js">function getTooltipContent(d) {
  return `
          &lt;b&gt;${d.civilization}&lt;/b&gt;
          &lt;br/&gt;
          &lt;b style=&#34;color:${d.color.darker()}&#34;&gt;${d.region}&lt;/b&gt;
          &lt;br/&gt;
          ${formatDate(d.start)} - ${formatDate(d.end)}
      `;
}

function createTooltip(el) {
  el.style(&#34;position&#34;, &#34;absolute&#34;)
    .style(&#34;pointer-events&#34;, &#34;none&#34;)
    .style(&#34;top&#34;, 0)
    .style(&#34;opacity&#34;, 0)
    .style(&#34;background&#34;, &#34;white&#34;)
    .style(&#34;border-radius&#34;, &#34;5px&#34;)
    .style(&#34;box-shadow&#34;, &#34;0 0 10px rgba(0,0,0,.25)&#34;)
    .style(&#34;padding&#34;, &#34;10px&#34;)
    .style(&#34;line-height&#34;, &#34;1.3&#34;)
    .style(&#34;font&#34;, &#34;11px sans-serif&#34;);
}

function getRect(d) {
  const el = d3.select(this);
  const sx = xPositionScale(d.start);
  const w = xPositionScale(d.end) - xPositionScale(d.start);
  const isLabelRight = sx &gt; width / 2 ? sx + w &lt; width : sx - w &gt; 0;

  el.style(&#34;cursor&#34;, &#34;pointer&#34;);

  el.append(&#34;rect&#34;)
    .attr(&#34;x&#34;, sx)
    .attr(&#34;height&#34;, yPositionScale.bandwidth())
    .attr(&#34;width&#34;, w)
    .attr(&#34;fill&#34;, d.color);

  el.append(&#34;text&#34;)
    .text(d.civilization)
    .attr(&#34;class&#34;, &#34;civ-text&#34;)
    .attr(&#34;x&#34;, isLabelRight ? sx - 5 : sx + w + 5)
    .attr(&#34;y&#34;, 2.5)
    .attr(&#34;fill&#34;, &#34;black&#34;)
    .style(&#34;text-anchor&#34;, isLabelRight ? &#34;end&#34; : &#34;start&#34;)
    .style(&#34;dominant-baseline&#34;, &#34;hanging&#34;);
}

const margin = { top: 30, right: 30, bottom: 30, left: 30 };
const height = 1000 - margin.top - margin.bottom;
const width = 1000 - margin.left - margin.right;

var svg = d3
  .select(&#34;#chart&#34;)
  .append(&#34;svg&#34;)
  .attr(&#34;width&#34;, width + margin.left + margin.right)
  .attr(&#34;height&#34;, height + margin.top + margin.bottom)
  .append(&#34;g&#34;)
  .attr(&#34;transform&#34;, &#34;translate(&#34; + margin.left + &#34;,&#34; + margin.top + &#34;)&#34;);

const yPositionScale = d3.scaleBand().range([0, height]).padding(0.2);

const xPositionScale = d3.scaleLinear().range([0, width]);

const colorScale = d3.scaleOrdinal(d3.schemeSet2);
const formatDate = (d) =&gt; (d &lt; 0 ? `${-d}BC` : `${d}AD`);

const axisBottom = d3
  .axisBottom(xPositionScale)
  .tickPadding(2)
  .tickFormat(formatDate);

const axisTop = d3
  .axisTop(xPositionScale)
  .tickPadding(2)
  .tickFormat(formatDate);

d3.csv(&#34;civilization timelines - civilization timelines.csv&#34;, function (d) {
  return {
    ...d,
    start: +d.start,
    end: +d.end,
  };
}).then(ready);

function ready(datapoints) {
  datapoints = datapoints.sort((a, b) =&gt; a.start - b.start);

  xPositionScale.domain([
    d3.min(datapoints, (d) =&gt; d.start),
    d3.max(datapoints, (d) =&gt; d.end),
  ]);

  yPositionScale.domain(d3.range(datapoints.length));

  const dataByTimeline = d3
    .nest()
    .key((d) =&gt; d.timeline)
    .entries(datapoints);

  const dataByRegion = d3
    .nest()
    .key((d) =&gt; d.region)
    .entries(datapoints);
  
  const regions = d3
    .nest()
    .key((d) =&gt; d.region)
    .entries(datapoints)
    .map((d) =&gt; d.key);

  colorScale.domain(regions);

  const timelines = dataByTimeline.map((d) =&gt; d.key);

  let filteredData;
  filteredData = [].concat.apply(
    [],
    dataByRegion.map((d) =&gt; d.values)
  );
  console.log(dataByRegion.map((d) =&gt; d.values))
  console.log(filteredData)

  filteredData.forEach((d) =&gt; (d.color = d3.color(colorScale(d.region))));

  const groups = svg
    .selectAll(&#34;g&#34;)
    .data(filteredData)
    .enter()
    .append(&#34;g&#34;)
    .attr(&#34;class&#34;, &#34;civ&#34;);

  const tooltip = d3.select(document.createElement(&#34;div&#34;)).call(createTooltip);

  const line = svg
    .append(&#34;line&#34;)
    .attr(&#34;y1&#34;, 10)
    .attr(&#34;y2&#34;, height)
    .attr(&#34;stroke&#34;, &#34;rgba(0,0,0,0.2)&#34;)
    .style(&#34;pointer-events&#34;, &#34;none&#34;);

  groups.attr(&#34;transform&#34;, (d, i) =&gt; `translate(0 ${yPositionScale(i)})`);

  groups
    .each(getRect)
    .on(&#34;mouseover&#34;, function (d) {
      d3.select(this).select(&#34;rect&#34;).attr(&#34;fill&#34;, d.color.darker());

      tooltip.style(&#34;opacity&#34;, 1).html(getTooltipContent(d));
    })
    .on(&#34;mouseleave&#34;, function (d) {
      d3.select(this).select(&#34;rect&#34;).attr(&#34;fill&#34;, d.color);
      tooltip.style(&#34;opacity&#34;, 0);
    });

  svg
    .append(&#34;g&#34;)
    .call(axisTop);

  svg
    .append(&#34;g&#34;)
    .attr(&#34;transform&#34;, (d, i) =&gt; `translate(0 ${height})`)
    .call(axisBottom);

  svg.on(&#34;mousemove&#34;, function (d) {
    let [x, y] = d3.mouse(this);
    line.attr(&#34;transform&#34;, `translate(${x} 0)`);
    y += 20;
    if (x &gt; width / 2) x -= 100;

    tooltip.style(&#34;left&#34;, x + &#34;px&#34;).style(&#34;top&#34;, y + &#34;px&#34;);
  });
}
</code></pre>
          
          </div>
      
          <div class="file">
          <h2>civilization timelines - civilization timelines.csv</h2>
          
              <pre><code class="language-csv">civilization,start,end,startLabel,endLabel,region,timeline
Aegean civilization,-2000,-1200,,,Europe (and colonial offshoots),ANCIENT WORLD
&#34;Age of pre-colonial civilization (Christian, Islamic, and traditional kingdoms)&#34;,650,1880,,,Sub-Saharan Africa,MEDIEVAL WORLD
Age of Turkic empires,500,1200,,,Middle East,MEDIEVAL WORLD
Age of united Caliphate,650,900,,,Middle East,MEDIEVAL WORLD
Ancient Andean region,-1000,500,,,pre-colonial Americas,ANCIENT WORLD
Ancient China,-2000,500,,,East Asia,ANCIENT WORLD
Ancient Steppe empires,-1000,500,,,the Steppe,ANCIENT WORLD
British India,1800,1945,,WWII,South Asia,MODERN WORLD
Classic age of Mesoamerica,100,900,,,pre-colonial Americas,ANCIENT WORLD
Colonial Africa,1880,1980,,,Sub-Saharan Africa,MODERN WORLD
Colonial United States,1500,1776,,,Europe (and colonial offshoots),MODERN WORLD
Early Islamic period,1200,1500,,,South Asia,MEDIEVAL WORLD
Early modern China,1500,1918,,WWI,East Asia,MODERN WORLD
Early modern Europe,1500,1800,,,Europe (and colonial offshoots),MODERN WORLD
Early Nubian civilization,-2000,-1000,,,Sub-Saharan Africa,ANCIENT WORLD
Egyptian civilization,-3000,-550,,,Middle East,ANCIENT WORLD
First Persian Empire,-550,-330,,,Middle East,ANCIENT WORLD
Formative age of Mesoamerica,-1500,100,,,pre-colonial Americas,ANCIENT WORLD
Formative Japan (age of Yamato rule),500,800,,,East Asia,MEDIEVAL WORLD
Formative US,1776,1865,,,Europe (and colonial offshoots),MODERN WORLD
Fractured Islamic world,900,2018,,present,Middle East,MODERN WORLD
Great power US,1865,1945,,WWII,Europe (and colonial offshoots),MODERN WORLD
Greek age,-1200,0,,,Europe (and colonial offshoots),ANCIENT WORLD
Heian age,800,1200,,,East Asia,MEDIEVAL WORLD
Imperial Japan,1870,1945,,WWII,East Asia,MODERN WORLD
Indian kingdom age,-500,1200,,,South Asia,ANCIENT WORLD
Indus civilization,-2500,-1500,,,South Asia,ANCIENT WORLD
Inter-Persian period,-330,200,,,Middle East,ANCIENT WORLD
Kush,-1000,300,,,Sub-Saharan Africa,ANCIENT WORLD
Medieval Andean region,500,1530,,,pre-colonial Americas,MEDIEVAL WORLD
Medieval China,500,1500,,,East Asia,MEDIEVAL WORLD
Medieval Europe,500,1500,,,Europe (and colonial offshoots),MEDIEVAL WORLD
Mesopotamian civilization,-3500,-550,,,Middle East,ANCIENT WORLD
Modern Africa,1980,2018,WWII,present,Sub-Saharan Africa,MODERN WORLD
Modern Europe,1800,2018,,present,Europe (and colonial offshoots),MODERN WORLD
Modern India,1945,2018,,present,South Asia,MODERN WORLD
Modern Japan,1945,2018,,present,East Asia,MODERN WORLD
Mongol Empire,1200,1300,,,the Steppe,MEDIEVAL WORLD
Mughal Empire,1500,1800,,,South Asia,MODERN WORLD
Peak of Aksum,300,650,,,Sub-Saharan Africa,MEDIEVAL WORLD
People&#39;s Republic of China,1945,2018,WWII,present,East Asia,MODERN WORLD
Postclassic age of Mesoamerica,900,1520,,,pre-colonial Americas,MEDIEVAL WORLD
Ptolemaic Egypt,-330,0,,,Middle East,ANCIENT WORLD
Republic of China,1918,1945,,,East Asia,MODERN WORLD
Roman &gt; Byzantine Egypt,0,650,,,Middle East,ANCIENT WORLD
Roman Empire,0,500,,,Europe (and colonial offshoots),ANCIENT WORLD
Roman Republic,-500,0,,,Europe (and colonial offshoots),ANCIENT WORLD
Second Persian Empire,-200,650,,,Middle East,ANCIENT WORLD
Shogunate,1200,1870,,,East Asia,MEDIEVAL WORLD
Superpower US,1945,2018,,present,Europe (and colonial offshoots),MODERN WORLD
Vedic age,-1500,-500,,,South Asia,ANCIENT WORLD</code></pre>
          
          </div>
      
    </div>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/github.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <script>
      function changeVersion(target) {
        const url = `/@tezzutezzu/world-history-timeline/${target}/`;
        window.location.href = url;
      }

      const versionSelector = document.querySelector("#version-selector")
      versionSelector.addEventListener('change', () => {
        changeVersion(versionSelector.value);
      })
    </script>
  </body>
</html>